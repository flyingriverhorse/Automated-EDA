# Notebook JavaScript Modularization

The `static/js/eda/notebook.js` script had grown beyond 8,000 lines, making it difficult to navigate and maintain. The codebase has now been reorganized into smaller, topic-focused modules located in `static/js/eda/notebook/modules/`.

## Folder layout

```
static/js/eda/notebook/
├── modules/
│   ├── 01-core.js
│   ├── 02-analysis-grid.js
│   ├── 03-analysis-execution.js
│   ├── 04-column-insights.js
│   ├── 05-categorical-modal.js
│   ├── 06-numeric-modal.js
│   ├── 07-crosstab-modal.js
│   ├── 08-marketing.js
│   └── 09-init.js
└── notebook.js  ← auto-generated bundle
```

- `01-core.js` keeps global state, helpers, and shared utilities.
- `02-analysis-grid.js` handles the interactive analysis grid UI.
- `03-analysis-execution.js` contains cell creation, execution, and rerun logic.
- `04-column-insights.js` manages column insights fetching, filters, and preprocessing helpers.
- `05-07` cover the categorical, numeric, and cross-tab modal workflows respectively.
- `08-marketing.js` encapsulates the marketing analysis modal tooling.
- `09-init.js` wires everything together on `DOMContentLoaded`.

Each file is still plain browser JavaScript, so functions and globals continue to live on the `window` object. Loading order is important, which is why an explicit numeric prefix is used.

## Auto-generated bundle

The runtime still serves a single `notebook.js` file for compatibility with existing templates and tests. The bundle is generated by concatenating the module files in order.

A helper script is available:

```bash
python tools/build_notebook_bundle.py
```

The script rewrites `static/js/eda/notebook.js` with a short header followed by the concatenated module contents. The bundle file now includes a note warning not to edit it directly.

To check whether the bundle is up to date without modifying it, use:

```bash
python tools/build_notebook_bundle.py --check
```

## Workflow tips

1. Edit the appropriate file in `static/js/eda/notebook/modules/`.
2. Run the build script to regenerate the bundle.
3. Re-run relevant tests (`pytest test_modern_interface.py`, etc.) to confirm everything still passes.

Because the module files are plain scripts, no additional build tooling is required.
